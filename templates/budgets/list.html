{% extends 'base.html' %}

{% block title %}Budgets - Finance Manager{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-6">
            <h1 class="display-6 fw-bold text-light">
                <i class="bi bi-piggy-bank"></i> Mes Budgets
            </h1>
        </div>
        <div class="col-md-6 text-end">
            <a href="{% url 'core:budget_create' %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Nouveau budget
            </a>
        </div>
    </div>

    {% if budgets_with_data %}
    <div class="row">
        {% for item in budgets_with_data %}
        <div class="col-lg-6 mb-4">
            <div
                class="card shadow-sm {% if item.budget.is_exceeded %}border-danger{% elif item.budget.is_over_threshold %}border-warning{% endif %}">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        {{ item.budget.category.icon }} {{ item.budget.category.name }}
                    </h5>
                    <span class="badge bg-secondary">{{ item.budget.period }}</span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Dépensé:</span>
                        <strong class="{% if item.budget.is_exceeded %}text-danger{% endif %}">
                            {{ item.spent|floatformat:2 }} € / {{ item.budget.amount|floatformat:2 }} €
                        </strong>
                    </div>

                    <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar {% if item.budget.is_exceeded %}bg-danger{% elif item.budget.is_over_threshold %}bg-warning{% else %}bg-success{% endif %}"
                            role="progressbar"
                            style="width: {% if item.percentage > 100 %}100{% else %}{{ item.percentage|floatformat:0 }}{% endif %}%">
                            {{ item.percentage|floatformat:0 }}%
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mb-2">
                        <span>Restant:</span>
                        <strong class="{% if item.remaining < 0 %}text-danger{% else %}text-success{% endif %}">
                            {{ item.remaining|floatformat:2 }} €
                        </strong>
                    </div>

                    {% if item.budget.is_exceeded %}
                    <div class="alert alert-danger small mb-2">
                        <i class="bi bi-exclamation-triangle"></i> Budget dépassé!
                    </div>
                    {% elif item.budget.is_over_threshold %}
                    <div class="alert alert-warning small mb-2">
                        <i class="bi bi-exclamation-circle"></i> Seuil d'alerte atteint ({{ item.budget.alert_threshold }}%)
                    </div>
                    {% endif %}

                    <div class="text-end mt-3">
                        <a href="{% url 'core:budget_update' item.budget.pk %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i> Modifier
                        </a>
                        <a href="{% url 'core:budget_delete' item.budget.pk %}" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i> Supprimer
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card shadow-sm">
        <div class="card-body text-center py-5 text-muted">
            <i class="bi bi-piggy-bank" style="font-size: 3rem;"></i>
            <p class="mt-3">Aucun budget défini</p>
            <a href="{% url 'core:budget_create' %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Créer votre premier budget
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}